<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SignalBox: SignalBox.ino File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SignalBox
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">SignalBox.ino File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="_config_8h_source.html">Config.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_messages_8h_source.html">Messages.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_persisted_8h_source.html">Persisted.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_i2c_comms_8h_source.html">I2cComms.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_system_8h_source.html">System.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_output_def_8h_source.html">OutputDef.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_forward_8h_source.html">Forward.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_ezy_bus_8h_source.html">EzyBus.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_output_ctl_8h_source.html">OutputCtl.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_input_def_8h_source.html">InputDef.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_input_mgr_8h_source.html">InputMgr.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_signal_box_8h_source.html">SignalBox.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_display_8h_source.html">Display.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_buttons_8h_source.html">Buttons.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_report_8h_source.html">Report.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_import_export_8h_source.html">ImportExport.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_controller_8h_source.html">Controller.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="_configure_8h_source.html">Configure.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a32e432ba77586213b13b0bdd280058ab"><td class="memItemLeft" align="right" valign="top"><a id="a32e432ba77586213b13b0bdd280058ab"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>SB_CONTROLLER</b>&#160;&#160;&#160;true</td></tr>
<tr class="separator:a32e432ba77586213b13b0bdd280058ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0f1764e167ed6a3566a4a81602f614a"><td class="memItemLeft" align="right" valign="top"><a id="ab0f1764e167ed6a3566a4a81602f614a"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>COMMAND_BUFFER_LEN</b>&#160;&#160;&#160;8</td></tr>
<tr class="separator:ab0f1764e167ed6a3566a4a81602f614a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a83443f1aa10bfe618b22d83147b88da6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a83443f1aa10bfe618b22d83147b88da6">systemFail</a> (PGM_P aMessage, int aValue)</td></tr>
<tr class="separator:a83443f1aa10bfe618b22d83147b88da6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ce56b81d6628fc2439aee08f3816ae2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a5ce56b81d6628fc2439aee08f3816ae2">firstRun</a> ()</td></tr>
<tr class="separator:a5ce56b81d6628fc2439aee08f3816ae2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95300e042d6726956172fa2748394116"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a95300e042d6726956172fa2748394116">defaultInputs</a> (uint8_t aInputType)</td></tr>
<tr class="separator:a95300e042d6726956172fa2748394116"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48150363f244f7864b1f4c2c8d5548a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a48150363f244f7864b1f4c2c8d5548a7">ezyBusConvert</a> ()</td></tr>
<tr class="separator:a48150363f244f7864b1f4c2c8d5548a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a71b08acccdb6e080e6531b44c196fb01"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a71b08acccdb6e080e6531b44c196fb01">processCommand</a> ()</td></tr>
<tr class="separator:a71b08acccdb6e080e6531b44c196fb01"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a793eb0c9e2cf49be0fa78f3f430a9081"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a793eb0c9e2cf49be0fa78f3f430a9081">handleSerialInput</a> ()</td></tr>
<tr class="separator:a793eb0c9e2cf49be0fa78f3f430a9081"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b198aa6beabb002340f9f67e03717a5"><td class="memItemLeft" align="right" valign="top">boolean&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a4b198aa6beabb002340f9f67e03717a5">gatewayRequest</a> ()</td></tr>
<tr class="separator:a4b198aa6beabb002340f9f67e03717a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fc01d736fe50cf5b977f755b675f11d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#a4fc01d736fe50cf5b977f755b675f11d">setup</a> ()</td></tr>
<tr class="separator:a4fc01d736fe50cf5b977f755b675f11d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe461d27b9c48d5921c00d521181f12f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_signal_box_8ino.html#afe461d27b9c48d5921c00d521181f12f">loop</a> ()</td></tr>
<tr class="separator:afe461d27b9c48d5921c00d521181f12f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:abf3c70591b993dceed8c6d038cd4aa19"><td class="memItemLeft" align="right" valign="top"><a id="abf3c70591b993dceed8c6d038cd4aa19"></a>
char&#160;</td><td class="memItemRight" valign="bottom"><b>commandBuffer</b> [COMMAND_BUFFER_LEN+1]</td></tr>
<tr class="separator:abf3c70591b993dceed8c6d038cd4aa19"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc8da2a9de68120622e044a7241a51ef"><td class="memItemLeft" align="right" valign="top"><a id="acc8da2a9de68120622e044a7241a51ef"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>commandLen</b> = 0</td></tr>
<tr class="separator:acc8da2a9de68120622e044a7241a51ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ef90926c9a05dcb1b2fac4a9655e546"><td class="memItemLeft" align="right" valign="top"><a id="a0ef90926c9a05dcb1b2fac4a9655e546"></a>
long&#160;</td><td class="memItemRight" valign="bottom"><b>now</b> = 0L</td></tr>
<tr class="separator:a0ef90926c9a05dcb1b2fac4a9655e546"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3641954fbc4048691928d0b053ff044a"><td class="memItemLeft" align="right" valign="top"><a id="a3641954fbc4048691928d0b053ff044a"></a>
long&#160;</td><td class="memItemRight" valign="bottom"><b>tickHardwareScan</b> = 0L</td></tr>
<tr class="separator:a3641954fbc4048691928d0b053ff044a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70151607b020f6c8c81e5ec35b667887"><td class="memItemLeft" align="right" valign="top"><a id="a70151607b020f6c8c81e5ec35b667887"></a>
long&#160;</td><td class="memItemRight" valign="bottom"><b>tickInputScan</b> = 0L</td></tr>
<tr class="separator:a70151607b020f6c8c81e5ec35b667887"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8ba33fd84d98d761a598ba4b88274ab9"><td class="memItemLeft" align="right" valign="top"><a id="a8ba33fd84d98d761a598ba4b88274ab9"></a>
long&#160;</td><td class="memItemRight" valign="bottom"><b>tickGateway</b> = 0L</td></tr>
<tr class="separator:a8ba33fd84d98d761a598ba4b88274ab9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aedceaaa958b9b3affaacb24f74a47e0f"><td class="memItemLeft" align="right" valign="top"><a id="aedceaaa958b9b3affaacb24f74a47e0f"></a>
long&#160;</td><td class="memItemRight" valign="bottom"><b>tickHeartBeat</b> = 0L</td></tr>
<tr class="separator:aedceaaa958b9b3affaacb24f74a47e0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>SignalBox.</p>
<p>(c)Copyright Tony Clulow 2021 <a href="#" onclick="location.href='mai'+'lto:'+'ton'+'y.'+'clu'+'lo'+'w@p'+'en'+'tad'+'te'+'ch.'+'co'+'m'; return false;">tony.<span style="display: none;">.nosp@m.</span>clul<span style="display: none;">.nosp@m.</span>ow@pe<span style="display: none;">.nosp@m.</span>ntad<span style="display: none;">.nosp@m.</span>tech.<span style="display: none;">.nosp@m.</span>com</a></p>
<p>This work is licensed under the: Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License. <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">http://creativecommons.org/licenses/by-nc-sa/4.0/</a></p>
<p>For commercial use, please contact the original copyright holder(s) to agree licensing terms.</p>
<p>Main SignalBox module.</p>
<p>Libraries used:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Name </th><th class="markdownTableHeadNone">Purpose  </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">EEPROM </td><td class="markdownTableBodyNone">Reading and writing to EEPROM memory.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Wire </td><td class="markdownTableBodyNone">To handle i2c communications.  </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">LiquidCrystal </td><td class="markdownTableBodyNone">For driving an LCD shield attached to the Uno.  </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">LiquidCrystal_I2C </td><td class="markdownTableBodyNone">For driving an LCD attached by i2c. Set LCD_I2C false to disable this functionality.  </td></tr>
</table>
<p>Pin usage:</p>
<p>D0 Serial Rx. D1 Serial Tx. D2 Alternate up button. D3 Alternate right button. D4 LCD shield data D4. D5 LCD shield data D5. D6 LCD shield data D6. D7 LCD shield data D7. D8 LCD shield rs. D9 LCD shield enable. D10 LCD shield backlight. D11 LCD shield detect. D12 Unused. D13 Flash firmare version and Interlock warning.</p>
<p>A0 LCD shield buttons. A1 Alternate select button. A2 Alternate left button. A3 Alternate down button. A4 I2C SDA. A5 I2C SCL. A6 Not available. A7 Not available. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a83443f1aa10bfe618b22d83147b88da6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a83443f1aa10bfe618b22d83147b88da6">&#9670;&nbsp;</a></span>systemFail()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void systemFail </td>
          <td>(</td>
          <td class="paramtype">PGM_P&#160;</td>
          <td class="paramname"><em>aMessage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>aValue</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Report a system failure. </p>

</div>
</div>
<a id="a5ce56b81d6628fc2439aee08f3816ae2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5ce56b81d6628fc2439aee08f3816ae2">&#9670;&nbsp;</a></span>firstRun()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void firstRun </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Software hasn't been run before. </p>

</div>
</div>
<a id="a95300e042d6726956172fa2748394116"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95300e042d6726956172fa2748394116">&#9670;&nbsp;</a></span>defaultInputs()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void defaultInputs </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>aInputType</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Set the default initial setup 1-1 mapping, inputs to outputs. </p>

</div>
</div>
<a id="a48150363f244f7864b1f4c2c8d5548a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a48150363f244f7864b1f4c2c8d5548a7">&#9670;&nbsp;</a></span>ezyBusConvert()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ezyBusConvert </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Convert EzyBus configuration. One-one mapping with EzyBus modules, and their inputs. </p>

</div>
</div>
<a id="a71b08acccdb6e080e6531b44c196fb01"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a71b08acccdb6e080e6531b44c196fb01">&#9670;&nbsp;</a></span>processCommand()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void processCommand </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Process a received command. Using the contents of the commandBuffer: iNP - Action input for node N, pin P. lNP - Action output Lo for node N, pin P. hNP - Action output Hi for node N, pin P. oNP - Action output Hi/Lo (based on current state) for node N, pin P. </p>

</div>
</div>
<a id="a793eb0c9e2cf49be0fa78f3f430a9081"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a793eb0c9e2cf49be0fa78f3f430a9081">&#9670;&nbsp;</a></span>handleSerialInput()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handleSerialInput </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Handle input on the Serial interface, </p>

</div>
</div>
<a id="a4b198aa6beabb002340f9f67e03717a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4b198aa6beabb002340f9f67e03717a5">&#9670;&nbsp;</a></span>gatewayRequest()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">boolean gatewayRequest </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>See if there's a Gateway request. Process the request. Return true if work done. </p>

</div>
</div>
<a id="a4fc01d736fe50cf5b977f755b675f11d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fc01d736fe50cf5b977f755b675f11d">&#9670;&nbsp;</a></span>setup()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setup </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Setup the Arduino. </p>

</div>
</div>
<a id="afe461d27b9c48d5921c00d521181f12f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe461d27b9c48d5921c00d521181f12f">&#9670;&nbsp;</a></span>loop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loop </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Main loop. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
